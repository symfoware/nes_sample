<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
    <title>CHR</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- ref: https://bugzmanov.github.io/nes_ebook/chapter_6_3.html -->

<style type="text/css">
.canvas-wrapper {
    position: relative;
}
.canvas-wrapper canvas {
    position: absolute;
    top: 0;
    left: 0;
}
</style>
</head>
<body>
    <div>
        <input type="file" id="file" />
        <button id="save">保存</button>
        <button id="prev">＜</button>
        <button id="next">＞</button>
    </div>
    <!-- https://qiita.com/Teinishi/items/4b84deadb26f1c450722 -->
    <div class="canvas-wrapper">
        <canvas id="preview" width="1024" height="1024"></canvas>
        <canvas id="previewCover" width="1024" height="1024"></canvas>
        
    </div>
<script type="module">
import { CHR } from './chr.js';
$(() => {

    // 解析クラス初期化
    const chr = new CHR(preview, previewCover);

    $('#file').on('change', function(event) {
        const reader = new FileReader();
        // 読み込みが完了したら、結果を表示
        reader.onload = function (event) {
            //loadCHR(event.target.result);
            chr.load(event.target.result);
        };
        // ファイルをテキストとして読み込む
        reader.readAsArrayBuffer(event.target.files[0]);
    });

    $('#save').on('click', function() {
        // aタグの生成
        const a = document.createElement('a');
        // レスポンスからBlobオブジェクト＆URLの生成
        const blobUrl = window.URL.createObjectURL(new Blob([chr.toArray()], {
            type: chr.type
        }));
        document.body.appendChild(a);
        a.style = 'display: none';
        // 生成したURLをセット
        a.href = blobUrl;
        // ダウンロードの時にファイル名として表示される
        a.download = 'downlad.chr';
        // クリックイベント発火
        a.click();
    });

    $('#prev').on('click', function() {
        chr.prev();
    });

    $('#next').on('click', function() {
        chr.next();
    });

});
</script>

</body>
</html>